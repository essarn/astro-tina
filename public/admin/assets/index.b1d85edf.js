import{p as H,v as T,T as te,a as Q,g as $,i as V,b as B,c as Y,d as K,s as re,e as R,r as ae,F as I,f as ne,G as ie,N as se,h as oe,R as O,j as J,k as h,u as X,l as le,m as ce,n as me,o as fe,q as ue,t as de,w as pe}from"./vendor.56022a33.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function i(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerpolicy&&(r.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?r.credentials="include":a.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(a){if(a.ep)return;a.ep=!0;const r=i(a);fetch(a.href,r)}})();const ye=async({schema:e,optimizedDocumentNode:t})=>{const i=[],r=T(t,{OperationDefinition:c=>c.name?c:{...c,name:{kind:"Name",value:"QueryOperation"}}}),s=new te(e),o=c=>{var b;return{...c,selectionSet:{...c.selectionSet||{kind:"SelectionSet",selections:[]},selections:[...((b=c.selectionSet)==null?void 0:b.selections)||[],...ge]}}},m=(c,b)=>{let g=b;const S=[];return c.forEach(D=>{g=g[D],Array.isArray(g)||g.kind==="Field"&&S.push(g.name.value)}),S},l=(c,b,g,S,D)=>{const N=m(S,D[0]),p=E=>{var U,C;const A=[];return T(E,Q(s,{Field:{enter:y=>{var _,w,F;if(s.enter(y),y.name.value!==E.name.value)if((_=y.selectionSet)!=null&&_.selections.length){const G=p(y);return A.push({name:y.name.value,alias:((w=y.alias)==null?void 0:w.value)||y.name.value,fields:G.fields}),!1}else A.push({name:y.name.value,alias:((F=y.alias)==null?void 0:F.value)||y.name.value})},leave:y=>{s.leave(y)}}})),A!=null&&A.length?{name:E.name.value,alias:((U=E.alias)==null?void 0:U.value)||E.name.value,fields:A}:{name:E.name.value,alias:((C=E.alias)==null?void 0:C.value)||E.name.value}},v=p(c),M=(E=>{if(!E)return[];const U=((y,_)=>y.reduce((w,F)=>({...w,[F[_]]:[...w[F[_]]||[],F]}),{}))(E,"alias"),C=[];return Object.entries(U).forEach(([y,_])=>{const w=[];_.forEach(x=>{var q;(q=x.fields)==null||q.forEach(ee=>w.push(ee))});const F=_[0].name,G=_[0].alias;w!=null&&w.length?C.push({name:F,alias:G,fields:w}):C.push({name:F,alias:G})}),C})(v.fields);M!=null&&M.length?i.push({name:v.name,alias:v.alias,fields:M,path:N}):i.push({name:v.name,alias:v.alias,path:N})},u={InlineFragment:{enter:c=>{s.enter(c)},leave:c=>{s.leave(c)}},Field:{enter:(c,b,g,S,D)=>{s.enter(c);const N=s.getType();if(N){const p=$(N);if(V(p)&&p.name==="Node"||B(p)&&p.getTypes().every(k=>k.getInterfaces().some(M=>M.name==="Node"))||Y(p)&&p.getInterfaces().some(v=>v.name==="Node"))return o(c)}}}},f={InlineFragment:{enter:c=>{s.enter(c)},leave:c=>{s.leave(c)}},Field:{enter:(c,b,g,S,D)=>{s.enter(c);const N=s.getType();if(N){const p=$(N);if(V(p)&&p.name==="Node"||B(p)&&p.getTypes().every(k=>k.getInterfaces().some(M=>M.name==="Node"))||Y(p)&&p.getInterfaces().some(v=>v.name==="Node"))return l(c,b,g,S,D),!1}}}},d=T(r,Q(s,u));return T(d,Q(s,f)),{formifiedQuery:d,blueprints:i}},he=H(`
 query Sample {
  ...on Document {
    _internalSys: _sys {
      path
    }
  }
 }`),ge=he.definitions[0].selectionSet.selections,be=K({tsTypes:{},schema:{context:{},services:{},events:{}},id:"(machine)",initial:"initializing",states:{initializing:{invoke:{src:"initializer",onDone:[{actions:["storeFormAndData","notifyParent"],target:"ready"}],onError:[{actions:"handleError",target:"error"}]}},ready:{},error:{}}},{actions:{notifyParent:re(e=>({type:"DOCUMENT_READY",value:e.id})),handleError:(e,t)=>{console.error(t.data)},storeFormAndData:R((e,t)=>({...e,form:t.data.form,data:t.data.data}))},services:{initializer:async e=>{const i=await e.cms.api.tina.request(`query GetNode($id: String!) {
        node(id: $id) {
          ...on Document {
            _internalValues: _values
            _internalSys: _sys {
              breadcrumbs
              basename
              filename
              path
              extension
              relativePath
              title
              template
              collection {
                name
                slug
                label
                path
                format
                matches
                templates
                fields
                __typename
              }
              __typename
            }
          }
        }
      }`,{variables:{id:e.id}}),n=e.cms.api.tina.schema;if(!n)throw new Error("Schema must be provided");const a=n.getCollection(i.node._internalSys.collection.name);let r;if(a.templates?r=a.templates.find(f=>{if(typeof f=="string")throw new Error("Global templates not supported");return f.name===i.node._internalSys.template}):r=a,!r)throw new Error(`Unable to find template for node ${i.node._internalSys.path}`);const s=ae({collection:a,basename:i.node._internalSys.filename,schema:n,template:r}),o=async f=>{try{const d=`#graphql
              mutation UpdateDocument($collection: String!, $relativePath: String!, $params: DocumentMutation!) {
                updateDocument(collection: $collection, relativePath: $relativePath, params: $params) {
                  __typename
                }
              }
            `;await e.cms.api.tina.request(d,{variables:{collection:i.node._internalSys.collection.name,relativePath:i.node._internalSys.relativePath,params:n.transformPayload(i.node._internalSys.collection.name,f)}}),e.cms.alerts.success("Document saved!")}catch(d){e.cms.alerts.error("There was a problem saving your document"),console.error(d)}},m={id:e.id,label:i.node._internalSys.title||i.node._internalSys.collection.label,initialValues:i.node._internalValues,fields:s.fields,onSubmit:o},l=e.formifyCallback;return{form:Ee(m,e.cms,f=>l?l(f,e.cms):f.createForm(f.formConfig),!0),data:i.node}}}}),ve=(e,t)=>({createForm:a=>new I(a),createGlobalForm:(a,r)=>new I({...a,global:{global:!0,...r}})}),Ee=(e,t,i,n=!1,a)=>{const{createForm:r,createGlobalForm:s}=ve(),o="SKIPPED";let m,l;const u=()=>{l=o};if(!l){if(i?m=i({formConfig:e,createForm:r,createGlobalForm:s,skip:u},t):m=r(e),!(m instanceof I)){if(l===o)return;throw new Error("formify must return a form or skip()")}return m}},Z={id:null,data:null,selectedDocument:null,blueprints:[],documentMap:{},iframe:null},we=K({tsTypes:{},schema:{context:{},services:{},events:{}},id:"(machine)",type:"parallel",states:{pipeline:{initial:"idle",states:{idle:{entry:"clear",on:{ADD_QUERY:{target:"initializing"},SUBDOCUMENTS:{target:"pending"},IFRAME_MOUNTED:{actions:"setIframe"}}},initializing:{invoke:{src:"initializer",onDone:[{actions:"storeInitialValues",target:"pending"}],onError:[{actions:"handleError",target:"error"}]}},waiting:{on:{DOCUMENT_READY:{target:"pending"}}},pending:{invoke:{src:"setter",onDone:[{target:"ready"}],onError:[{actions:"handleMissingDocument",target:"waiting"}]}},ready:{entry:"resolveData",invoke:{src:"onChangeCallback"},on:{NAVIGATE:{target:"idle"},REMOVE_QUERY:{target:"idle"},SELECT_DOCUMENT:{actions:"selectDocument"},FIELD_CHANGE:{target:"pending"}}},error:{}}}}},{actions:{handleError:(e,t)=>console.error(t.data),handleMissingDocument:R((e,t)=>{if(j=j+1,j>50)throw new Error("infinite loop");if(t.data instanceof L){if(e.documentMap[t.data.id]||!t.data.id)return e;const i={ref:oe(be.withContext({id:t.data.id,cms:e.cms,formifyCallback:e.formifyCallback,form:null,data:null}))};return{...e,documentMap:{...e.documentMap,[t.data.id]:{...i,skipFormRegister:t.data.skipFormRegister}}}}else return console.error(t.data),e}),clear:R(e=>(e.cms.forms.all().forEach(t=>{e.cms.forms.remove(t.id)}),{...Z,formifyCallback:e.formifyCallback,cms:e.cms,iframe:e.iframe})),storeInitialValues:R((e,t)=>({...e,...t.data})),selectDocument:R((e,t)=>({...e,selectedDocument:t.value})),setIframe:R((e,t)=>({...e,iframe:t.value})),resolveData:R((e,t)=>{var i,n;return e.iframe&&((n=(i=e.iframe)==null?void 0:i.contentWindow)==null||n.postMessage({type:"updateData",id:e.id,data:t.data.data})),{...e,data:t.data.data}})},services:{setter:async e=>{const t=(n,a=[])=>{const r={};return Se(n)?n:(Object.entries(n).map(([s,o])=>{if(Array.isArray(o))r[s]=o.map(m=>t(m,[...a,s]));else{const m=e.blueprints.find(l=>{var u;return((u=l.path)==null?void 0:u.join("."))===[...a,s].join(".")});m?r[s]=_e(o,m,e):r[s]=t(o,[...a,s])}}),r)};return{data:t(e.data)}},initializer:async(e,t)=>{const i=e.cms.api.tina,n=await i.getSchema(),a=H(t.value.query),r=await i.getOptimizedQuery(a);if(!r)throw new Error("Unable to optimize query");const{blueprints:s,formifiedQuery:o}=await ye({schema:n,optimizedDocumentNode:r});return{data:await e.cms.api.tina.request(ne(o),{variables:t.value.variables}),blueprints:s,id:t.value.id}},onChangeCallback:e=>(t,i)=>{const n=e.cms.api.tina.schema;Object.values(e.documentMap).forEach(a=>{var m,l,u;if(a.skipFormRegister)return;const r=(m=a.ref.getSnapshot())==null?void 0:m.context,s=(l=r==null?void 0:r.data)==null?void 0:l._internalSys.collection.name,o=n.getCollection(s||"");r!=null&&r.form&&((u=o.ui)!=null&&u.global?e.cms.plugins.add(new ie(r.form)):e.cms.forms.add(r.form))}),e.cms&&(e.cms.events.subscribe("forms:fields:onChange",()=>{t({type:"FIELD_CHANGE"})}),e.cms.events.subscribe("forms:reset",()=>{t({type:"FIELD_CHANGE"})}))}}});class L extends Error{constructor(t,i,n){super(t),this.name="QueryError",this.id=i,this.skipFormRegister=n}}let j=0;const W=typeof Symbol<"u";function Se(e){const t=typeof e;return t==="string"||t==="number"||t==="boolean"||W===!0&&t==="symbol"||e==null||W===!0&&e instanceof Symbol||e instanceof String||e instanceof Number||e instanceof Boolean}const _e=(e,t,i)=>{var n,a,r,s,o;if(e!=null&&e._internalSys){const m=(n=e._internalSys)==null?void 0:n.path,l=i.documentMap[m],u=(r=(a=l==null?void 0:l.ref)==null?void 0:a.getSnapshot())==null?void 0:r.context,f=u==null?void 0:u.form;if(!f){const g=(((s=t.path)==null?void 0:s.length)||0)>2;throw new L("Unable to resolve form for initial document",m,g)}const d=(o=u.data)==null?void 0:o._internalSys;if(!d)throw new Error(`No system information found for document ${m}`);const c=f.fields,b=P({id:m,fields:c,sys:d,values:f.values,fieldsToInclude:t.fields,context:i});return{...u.data,...b}}return e},P=({id:e,fields:t,sys:i,values:n,fieldsToInclude:a,context:r})=>{const s={};return n&&(a==null||a.forEach(o=>{var l,u;const m=t.find(f=>o.name===f.name);if(m){const f=Fe({id:e,field:m,sys:i,value:n[m.name],fieldsToInclude:(u=a.find(({name:d})=>d===m.name))==null?void 0:u.fields,context:r});f&&(s[o.alias]=f)}else if(o.name==="id")s[o.alias]=e;else if(o.name==="_sys"){if(o.alias!=="_internalSys"){const f={};(l=o.fields)==null||l.forEach(d=>{f[d.alias]=i[d.name]}),s[o.alias]=f}}else o.name==="__typename"?s[o.alias]=se.dataTypeName(t[0].namespace.slice(0,t[0].namespace.length-1)):o.name==="_values"&&o.alias!=="_internalValues"&&(s[o.alias]=n)})),s},Fe=({id:e,field:t,sys:i,value:n,fieldsToInclude:a,context:r})=>{var s,o,m;switch(t.type){case"reference":if(!n)return;if(typeof n=="string"){const l=r.documentMap[n],u=(o=(s=l==null?void 0:l.ref)==null?void 0:s.getSnapshot())==null?void 0:o.context,f=u==null?void 0:u.form;if(!f)throw new L("Unable to resolve form for document",n,!0);const d=(m=u.data)==null?void 0:m._internalSys;if(!d)throw new Error(`No system information found for document ${e}`);return P({id:n,fields:f.fields,sys:d,values:f.values,fieldsToInclude:a,context:r})}throw new Error('Unexpected value for type "reference"');case"object":if(t.fields){if(typeof t.fields=="string")throw new Error("Global templates not supported");if(t.fields,t.list){if(Array.isArray(n))return n.map(l=>{if(typeof t.fields=="string")throw new Error("Global templates not supported");return P({id:e,fields:t.fields,sys:i,values:l,fieldsToInclude:a,context:r})})}else return P({id:e,fields:t.fields,sys:i,values:n,fieldsToInclude:a,context:r})}if(t.templates&&t.list)return!n||!Array.isArray(n)?void 0:n.map(l=>{let u;return Object.entries(t.templates).forEach(([f,d])=>{if(f===l._template){if(typeof d=="string")throw new Error("Global templates not supported");u=d}}),{_template:l._template,...P({id:e,fields:u.fields,sys:i,values:l,fieldsToInclude:a,context:r})}});default:return n}},De=e=>{const[t,i]=O.useState(null);return O.useEffect(()=>{e.iframeRef.current&&window.addEventListener("message",n=>{n.data.type==="open"&&i(n.data)})},[e.iframeRef.current]),J("div",{className:"tina-tailwind",children:[t&&h(Ne,{payload:t,iframeRef:e.iframeRef},t.id),h("div",{className:"h-full overflow-scroll",children:h("div",{className:"",children:h("div",{className:"col-span-5 ",children:h("div",{className:"h-screen flex flex-col",children:h("div",{className:"relative flex-1 bg-gray-300 col-span-2 overflow-scroll flex items-center justify-center",children:h("iframe",{ref:e.iframeRef,className:"h-full w-full bg-white",src:e.url})})})})})})]})},Ne=e=>{const t=X(),i=O.useMemo(()=>we.withContext({...Z,cms:t,formifyCallback:e.formifyCallback}),[]),[n,a]=le(i);return O.useEffect(()=>{n.matches("pipeline.ready")?t.events.dispatch({type:"forms:register",value:"complete"}):n.matches("pipeline.initializing")&&t.events.dispatch({type:"forms:register",value:"start"})},[JSON.stringify(n.value)]),O.useEffect(()=>{e.iframeRef.current&&(a({type:"IFRAME_MOUNTED",value:e.iframeRef.current}),e.payload.type==="open"&&a({type:"ADD_QUERY",value:e.payload}),window.addEventListener("message",r=>{r.data.type==="close"&&a({type:"REMOVE_QUERY"})}))},[e.iframeRef.current]),null},z=ce({branch:new Object().CF_PAGES_BRANCH,clientId:new Object().CLIENT_ID,token:new Object().TOKEN,build:{outputFolder:"admin",publicFolder:"public"},media:{tina:{mediaRoot:"uploads",publicFolder:"public"}},schema:{collections:[{name:"post",label:"Posts",path:"content/posts",fields:[{type:"string",name:"title",label:"Title",isTitle:!0,required:!0},{type:"rich-text",name:"body",label:"Body",isBody:!0}]}]}}),Me=({outputFolder:e})=>(X().flags.set("tina-preview",e),null),Ae=()=>J(fe,{...z,client:{apiUrl:"https://content.tinajs.io/content/f9226c92-e376-4dfe-8d9f-f68ed4bcca4e/github/main"},children:[h(Me,{outputFolder:z.build.outputFolder}),h(ue,{preview:De,config:z})]}),Re=()=>{const{setEdit:e}=de();return e(!0),h("div",{children:"Going into edit mode"})};function Ce(){return h(me,{editMode:h(Ae,{}),children:h(Re,{})})}pe.render(h(O.StrictMode,{children:h(Ce,{})}),document.getElementById("root"));
//# sourceMappingURL=index.b1d85edf.js.map
